(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,r=window.wp.components,s=window.wp.data,o=window.wp.element,n=(0,o.forwardRef)((function({icon:e,size:t=24,...r},s){return(0,o.cloneElement)(e,{width:t,height:t,...r,ref:s})})),d=window.wp.primitives,a=window.ReactJSXRuntime,i=(0,a.jsx)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,a.jsx)(d.Path,{d:"M13 5c-3.3 0-6 2.7-6 6 0 1.4.5 2.7 1.3 3.7l-3.8 3.8 1.1 1.1 3.8-3.8c1 .8 2.3 1.3 3.7 1.3 3.3 0 6-2.7 6-6S16.3 5 13 5zm0 10.5c-2.5 0-4.5-2-4.5-4.5s2-4.5 4.5-4.5 4.5 2 4.5 4.5-2 4.5-4.5 4.5z"})}),l=window.wp.i18n,c=e=>e.replace(/<\/?[^>]+(>|$)/g,""),m=(e,t)=>{const r=c(e.title.rendered);if(!t)return r;const s=r.split(new RegExp(`(${t})`,"gi"));return 1===s.length?r:s.map(((e,r)=>e.toLowerCase()===t.toLowerCase()?(0,a.jsx)("mark",{children:e},r):e))},p=(e,t)=>{if(!t)return"";const r=c(e.content.raw),s=((e,t,r=5)=>{if(!t)return[];const s=new RegExp(`(?:\\S+\\s+){0,${r}}\\b${t}\\b(?:\\s+\\S+){0,${r}}`,"gi");return e.match(s)||[]})(r,t);if(0===s.length)return"";const o=r.indexOf(s[0])>0;let n=s.join("…");o&&(n="…"+n),n=((e,t=50)=>e.length<=t?e:e.substring(0,t).trim()+"…")(n,50);const d=n.split(new RegExp(`(${t})`,"gi"));return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("br",{}),(0,a.jsx)("em",{className:"dmg-read-more-radio-excerpt",children:d.map(((e,r)=>e.toLowerCase()===t.toLowerCase()?(0,a.jsx)("mark",{children:e},r):e))})]})},g=({currentPage:e,posts:t,postByPostId:s,searchQuery:o,selectedPost:n,setAttributes:d})=>{const i=parseInt(n?.id);return!t&&!s||t&&0===t.length&&!s&&e>1?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.Spinner,{}),(0,a.jsx)("p",{children:(0,l.__)("Loading posts…","dmg-read-more")})]}):e<=1&&t&&0===t.length&&!s?(0,a.jsx)("p",{children:(0,l.__)("No posts found.","dmg-read-more")}):(0,a.jsxs)(a.Fragment,{children:[s&&(0,a.jsx)(r.RadioControl,{id:"dmg-read-more-found-post",label:(0,l.__)("Found Post Matching ID","dmg-read-more"),selected:i,options:[{label:s.title.rendered,value:s.id}],onChange:e=>{const t={id:e,title:s.title.rendered,link:s.link};d({selectedPost:t})}}),t&&0<t.length&&(0,a.jsx)(r.RadioControl,{id:"dmg-read-more-found-posts",label:o?(0,l.__)("Found Posts","dmg-read-more"):(0,l.__)("Latest Posts","dmg-read-more"),selected:i,options:t.map((e=>({label:(0,a.jsxs)(a.Fragment,{children:[m(e,o),p(e,o)]}),value:e.id}))),onChange:e=>{const r=t.find((t=>t.id===parseInt(e,10)));if(r){const t={id:e,title:r.title.rendered,link:r.link};d({selectedPost:t})}}})]})},h=({currentPage:e,totalPages:t,setCurrentPage:s})=>{if(t<=1)return null;const o=(0,a.jsxs)(a.Fragment,{children:[(0,l.__)("Page","dmg-read-more")," ",e," ",(0,l.__)("of","dmg-read-more")," ",t]});let n,d;return t<=3?(n=1,d=t):1===e?(n=1,d=3):e===t?(n=t-2,d=t):(n=e-1,d=e+1),(0,a.jsxs)(r.BaseControl,{help:o,hideLabelFromVision:!0,id:"dmg-read-more-pagination",label:(0,l.__)("Search Results Pagination","dmg-read-more"),children:[n>1&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(r.Button,{label:(0,l.__)("First","dmg-read-more"),showTooltip:!0,variant:"tertiary",onClick:()=>s(1),children:["«",(0,a.jsx)("span",{className:"screen-reader-text",children:(0,l.__)("First","dmg-read-more")})]}),(0,a.jsxs)(r.Button,{label:(0,l.__)("Previous","dmg-read-more"),showTooltip:!0,variant:"tertiary",onClick:()=>s(e-1),children:["‹",(0,a.jsx)("span",{className:"screen-reader-text",children:(0,l.__)("Previous","dmg-read-more")})]})]}),Array.from({length:d-n+1}).map(((t,o)=>{const d=n+o;return d===e?(0,a.jsx)(r.Button,{variant:"primary",disabled:!0,onClick:e=>e.preventDefault(),children:d},d):(0,a.jsx)(r.Button,{variant:"tertiary",onClick:()=>s(d),children:d},d)})),d<t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(r.Button,{label:(0,l.__)("Next","dmg-read-more"),showTooltip:!0,variant:"tertiary",onClick:()=>s(e+1),children:["›",(0,a.jsx)("span",{className:"screen-reader-text",children:(0,l.__)("Next","dmg-read-more")})]}),(0,a.jsxs)(r.Button,{label:(0,l.__)("Last","dmg-read-more"),showTooltip:!0,variant:"tertiary",onClick:()=>s(t),children:["»",(0,a.jsx)("span",{className:"screen-reader-text",children:(0,l.__)("Last","dmg-read-more")})]})]})]})},u=({selectedPost:e,setAttributes:n})=>{const[d,i]=(0,o.useState)(""),[c,m]=(0,o.useState)(1),{posts:p,postByPostId:u,totalPages:x}=(0,s.useSelect)((e=>{const t=e("core/editor").getCurrentPostId(),r={exclude:t?[t]:[],per_page:5,page:c,status:"publish"};let s=[],o=null;const n=/^\d+$/.test(d)?parseInt(d,10):NaN;if(!isNaN(n)&&n!==t){const t={...r,include:[n]},s=e("core").getEntityRecords("postType","post",t);s?.length&&(o=s[0])}return d&&(r.search=d),d||(r.order="desc",r.orderby="date"),s=e("core").getEntityRecords("postType","post",r),{posts:s,postByPostId:o,totalPages:e("core").getEntityRecordsTotalPages("postType","post",r)}}),[c,d]);return(0,a.jsx)(t.InspectorControls,{children:(0,a.jsxs)(r.PanelBody,{title:(0,l.__)("Select a Post","dmg-read-more"),children:[(0,a.jsx)(r.TextControl,{id:"dmg-read-more-search",label:(0,l.__)("Search Posts","dmg-read-more"),value:d,onChange:e=>{const t=0===e.trim().length,r=e.replace(/^\s+/,"").replace(/\s+$/," ");i(t?"":r),d.trim()!==r.trim()&&m(1)},placeholder:(0,l.__)("Enter post title or ID…","dmg-read-more")}),(0,a.jsx)(g,{currentPage:c,posts:p,postByPostId:u,searchQuery:d,selectedPost:e,setAttributes:n}),(0,a.jsx)(h,{currentPage:c,totalPages:x,setCurrentPage:m})]})})},x=JSON.parse('{"UU":"dmg/read-more"}');(0,e.registerBlockType)(x.UU,{edit:function({attributes:e,setAttributes:o}){const{selectedPost:d}=e,c=(0,t.useBlockProps)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u,{selectedPost:d,setAttributes:o}),(0,a.jsx)("div",{...c,children:d?.id?(0,a.jsx)("p",{className:"dmg-read-more",children:(0,a.jsx)(r.Disabled,{children:(0,a.jsxs)("a",{href:d.link,children:[(0,l.__)("Read More:","dmg-read-more")," ",d.title]})})}):(0,a.jsxs)("div",{className:"components-placeholder block-editor-media-placeholder is-large",children:[(0,a.jsxs)("div",{className:"components-placeholder__label",children:[(0,a.jsx)(n,{icon:i}),(0,l.__)("DMG Read More","dmg-read-more")]}),(0,a.jsx)("div",{className:"components-placeholder__instructions",children:(0,l.__)("Please choose or search for a post using the block settings.","dmg-read-more")}),(0,a.jsx)("div",{className:"components-placeholder__fieldset",children:(0,a.jsx)(r.Button,{variant:"primary",onClick:()=>{const e=(0,s.select)("core/edit-post").isEditorSidebarOpened(),t="edit-post/block"===(0,s.select)("core/edit-post").getActiveGeneralSidebarName();e&&t||(0,s.dispatch)("core/edit-post").openGeneralSidebar("edit-post/block"),e||(0,s.dispatch)("core/edit-post").openGeneralSidebar("inspector"),setTimeout((()=>{const e=document.getElementById("dmg-read-more-search");e&&(e.focus(),e.classList.add("highlight-effect"),setTimeout((()=>{e.classList.remove("highlight-effect")}),1e3))}),100)},children:(0,l.__)("Open Block Settings","dmg-read-more")})})]})})]})},save:function({attributes:e}){const{selectedPost:r}=e;return r?.id?(0,a.jsx)("div",{...t.useBlockProps.save(),children:(0,a.jsx)("p",{className:"dmg-read-more",children:(0,a.jsx)("a",{href:r.link,children:`Read More: ${r.title}`})})}):null}})})();